<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Plaza</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .form-label, .btn, h1 {
            font-size: 0.9rem;
        }
        .form-control, .form-select {
            font-size: 0.8rem;
            padding: 0.3rem;
        }
        .container {
            max-width: 400px;
        }
        /* Custom styling for button placement */
        .modal-footer {
            display: flex;
            justify-content: space-between;
        }
        .btn-left {
            margin-right: auto;
        }
        .modal-body {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .btn-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        /* Style for separator and message */
        .separator {
            width: 100%;
            border-top: 1px solid #ccc;
            margin: 10px 0;
        }
        .add-plaza-message {
            font-size: 0.8rem;
            color: #555;
        }
        .add-plaza-message a {
            text-decoration: none;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container mt-3">
        <h1 class="text-center">Add Plaza</h1>
        <form action="#" th:onsubmit="submitForm(event)" method="POST" id="addPlazaForm">
            <div class="mb-2">
                <label for="plaza_id" class="form-label">Plaza ID</label>
                <input type="text" class="form-control form-control-sm" id="plaza_id" name="plaza_id" placeholder="Enter Plaza ID" required>
            </div>
            <div class="mb-2">
                <label for="plaza_name" class="form-label">Plaza Name</label>
                <input type="text" class="form-control form-control-sm" id="plaza_name" name="plaza_name" placeholder="Enter Plaza Name" required>
            </div>
            <div class="mb-2">
                <label for="org_id" class="form-label">Organization ID</label>
                <input type="text" class="form-control form-control-sm" id="org_id" name="org_id" placeholder="Enter Organization ID" required>
            </div>
            <div class="mb-2">
                <label for="geoCode" class="form-label">Geo Code</label>
                <input type="text" class="form-control form-control-sm" id="geoCode" name="geoCode" placeholder="Enter Geo Code (latitude,longitude)" required>
            </div>
            <div class="mb-2">
                <label for="type" class="form-label">Type</label>
                <select class="form-select form-select-sm" id="type" name="type" required>
                    <option value="Toll">Toll</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="mb-2">
                <label for="subtype" class="form-label">Subtype</label>
                <select class="form-select form-select-sm" id="subtype" name="subtype" required>
                    <option value="State">State</option>
                    <option value="National">National</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary btn-sm w-100">Add Plaza</button>
        </form>
    </div>

    <!-- Success Popup Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body" id="successMessage">
                    <!-- Dynamic Success Message and Add Lane button will be added here -->
                    <div class="d-flex justify-content-between w-100">
                        <span id="messageText">Plaza added successfully! Plaza ID: 545099</span>
                        <button type="button" class="btn btn-primary btn-sm" id="addLaneButton">Add Lane</button>
                    </div>
                    <!-- Separator Line -->
                    <div class="separator"></div>
                    <!-- Add New Plaza Section -->
                    <div class="w-100">
                        <p class="add-plaza-message">Please click <a href="#" id="addNewPlazaLink">here</a> to add a new plaza.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function submitForm(event) {
            event.preventDefault();
            const formData = new FormData(document.getElementById("addPlazaForm"));
            const plazaData = Object.fromEntries(formData.entries());

            const response = await fetch('/plaza/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(plazaData),
            });

            if (response.ok) {
                const result = await response.json();
                // Show the success modal with Plaza ID message
                document.getElementById('messageText').innerText = `Plaza added successfully! Plaza ID: ${result.plaza_id}`;
                const successModal = new bootstrap.Modal(document.getElementById('successModal'), {
                    backdrop: 'static', // Prevent closing by clicking outside the modal
                    keyboard: false      // Prevent closing by pressing the Escape key
                });
                successModal.show();

                // Set up Add Lane button behavior
                document.getElementById("addLaneButton").onclick = function () {
                    window.location.href = `/add-lane?plaza_id=${result.plaza_id}`;
                };

                // Set up Add New Plaza link behavior
                document.getElementById("addNewPlazaLink").onclick = function () {
                    window.location.href = '/add-plaza'; // Redirect to the Add Plaza page again
                };
            } else {
                const errorMessage = await response.text();
                alert(`Error: ${errorMessage}`);
            }
        }
    </script>

    <!-- Bootstrap JS for Modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
